import{l as i,j as e,s as Ee,a as Le,g as fe,b as Oe,A as y,r as f,e as c,C as T,c as de,d as ze,R as G,f as J,h as _e,i as Be,P as Fe,k as ue,u as je,m as Pe,n as X,o as xe,p as Ge,q as qe,t as We,v as He,w as Ye,x as Je,y as Ze,z as he,B as me,D as $e,E as Ke,F as Ve,G as Qe,H as Xe,I as Ue,J as es,K as ss,L as te,M as ts}from"./main-1.0.6.js";import{B as q,A as $,C as ne,a as pe,b as rs}from"./AdminTheme-1.0.6-6896de59.js";import{B as l,u as B,M as V,a as is,b as N,T as k,c as as,A as Ae,d as Te,e as ye,f as U,g as os,h as ns,i as ps,j as ls,S as cs,D as z,k as ds,l as us,m as xs,v as hs,n as ms,o as gs,p as bs}from"./main-1.0.6-7aa8b30c.js";import{T as re,C as K,s as fs,S as Ce,R as js,a as ie,B as As,b as Ts,c as ys,d as Cs,e as ae}from"./settings-1.0.6-c1644694.js";import{C as ve,a as Se,b as De}from"./ComponentDatabase-1.0.6-9eec425a.js";import{A as w,a as E,b as Q}from"./AccordionSummary-1.0.6-e78821a8.js";import{T as W,F as ee,I as vs,S as Ss,a as se,b as le,A as ce}from"./TextField-1.0.6-b41aa978.js";import{M as Ds}from"./MenuItem-1.0.6-b9a91535.js";import{a as Rs,b as ks,c as Ms,d as Is,e as Ns,f as ws,g as Es}from"./ActionsApp-1.0.6-68143703.js";import{R as Ls}from"./RadioGroup-1.0.6-adb96ecd.js";import{R as ge}from"./Radio-1.0.6-2befae95.js";import{F as Re}from"./FormControlLabel-1.0.6-72a72881.js";import{l as Os,C as zs}from"./index-1.0.6-8954a6ee.js";import{I as _,T as be,P as ke}from"./iconBase-1.0.6-b8af29f5.js";import{T as oe}from"./Tabs-1.0.6-e49ea330.js";import{B as Y}from"./index.esm-1.0.6-f58f385b.js";import{L as Z}from"./Link-1.0.6-610563e0.js";import{c as _s}from"./index-1.0.6-f35018af.js";import{S as Bs,a as Fs,b as Ps}from"./Stepper-1.0.6-9f47df68.js";import{A as Gs}from"./AppMetaData-1.0.6-4364a40e.js";import{I as qs}from"./InputAdornment-1.0.6-f8c6f282.js";import{C as Ws}from"./Checkbox-1.0.6-26443287.js";import"./Close-1.0.6-4b5eac8d.js";import"./DialogContent-1.0.6-e7b9fcb3.js";import"./ActionsExplorer-1.0.6-044b946f.js";import"./useSlot-1.0.6-8db722c4.js";import"./Alert-1.0.6-728945e9.js";import"./AlertTitle-1.0.6-986ff958.js";const Hs=({app:s,setIsUpdated:o})=>(i.debug(s),e.jsxs(l,{children:[e.jsx(w,{disableGutters:!0,children:e.jsx(E,{children:e.jsx(ve,{setIsUpdated:o})})}),e.jsx(w,{disableGutters:!0,children:e.jsx(E,{children:e.jsx(Se,{setIsUpdated:o})})}),e.jsx(w,{disableGutters:!0,children:e.jsx(E,{children:e.jsx(De,{app:s,setIsUpdated:o})})})]})),Me=({app:s,hasErrors:o,setIsUpdated:p})=>{i.debug(s,o);const r=B();return e.jsx(W,{type:"text",label:"App Name",error:o,fullWidth:!0,required:!0,helperText:"App name must be unique",value:s.appName,autoFocus:!0,autoComplete:"off",onChange:x=>{r(Ee({appName:x.target.value})),p&&p(!0)}})},Ie=({app:s,hasErrors:o,setIsUpdated:p})=>{i.debug(s,o);const r=B();return e.jsx(W,{type:"text",label:"App Title",error:o,fullWidth:!0,required:!0,helperText:"App title describes the purpose of the app",value:s.appTitle,autoComplete:"off",onChange:x=>{r(Le({appTitle:x.target.value})),p&&p(!0)}})},Ne=({app:s,setIsUpdated:o})=>{i.debug(s);const p=B(),r=fe();return i.debug(r),e.jsxs(ee,{children:[e.jsx(vs,{variant:"outlined",children:"App Type *"}),e.jsxs(Ss,{label:"App Type *",value:s.appType,onChange:x=>{p(Oe({appType:x.target.value})),o&&o(!0)},children:[...r.map(x=>{const b=x.id===y.DATATABLE||x.id===y.DATAENTRY;return e.jsx(Ds,{value:x.id,disabled:!b,children:x.text})})]}),e.jsx(se,{children:"Select app type from drop-down list (currently supporting Data Tables and Data Administration only, more types will be added later)"})]})},Ys=({app:s})=>{i.debug(s);const[o,p]=f.useState(!1),[r,x]=f.useState(void 0),b=()=>{switch(r){case"form":return"Reset Form Builder?";case"theme":return"Reset Theme?";default:return"Reset Table Builder?"}};return e.jsxs(e.Fragment,{children:[e.jsxs(w,{disableGutters:!0,children:[e.jsx(E,{expandIcon:e.jsx(V,{}),children:"Reset"}),e.jsx(Q,{children:e.jsxs(ee,{sx:{display:"grid",gridGap:"20px"},children:[e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{x(re.TABLE),p(!0)},children:"Reset Table Builder"}),e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{x(re.FORM),p(!0)},children:"Reset Form Builder"}),e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{x(re.THEME),p(!0)},children:"Reset Theme"}),e.jsxs(se,{sx:{display:"inline-grid",gridTemplateColumns:"20px auto",gridGap:"5px",alignItems:"center","& svg":{fontSize:"20px"}},children:[e.jsx(is,{}),"A reset cannot be undone!"]})]})})]}),e.jsx(K,{title:b(),message:"Are you sure? This action cannot be undone!",open:o,setOpen:p,onConfirm:()=>{r!==void 0&&fs(s.appDbId,s.appCntId,r,null,null,u=>{if(u!=null&&u.code&&(u==null?void 0:u.message)!==void 0)switch(u.code){case"ok":c(u.message,{variant:"success"});break;case"info":c(u.message,{variant:"info"});break;default:c(u.message??T.contactSupport,{variant:"error"})}else i.error(u),c(T.contactSupport,{variant:"error"})},u=>{i.error("error",u),c(u??T.contactSupport,{variant:"error"})})}})]})},Js=({app:s,setIsUpdated:o})=>(i.debug(s),e.jsxs(l,{children:[e.jsx(w,{disableGutters:!0,children:e.jsx(E,{children:e.jsx(Me,{app:s,hasErrors:!1,setIsUpdated:o})})}),e.jsx(w,{disableGutters:!0,children:e.jsx(E,{children:e.jsx(Ie,{app:s,hasErrors:!1,setIsUpdated:o})})}),e.jsx(w,{disableGutters:!0,children:e.jsx(E,{children:e.jsx(Ne,{app:s,setIsUpdated:o})})}),e.jsx(Ys,{app:s})]})),we=({setIsUpdated:s})=>{const o=B(),p=N(a=>de(a));i.debug("app",p);const r=N(a=>ze(a));i.debug("appMetaData",r);const x=f.useMemo(()=>{const a=[];if((r==null?void 0:r.roles)!==void 0)for(const A in r.roles)a.push({key:A,value:r.roles[A]});return a},[r.roles]);i.debug(x);const b=f.useMemo(()=>{const a=[];if((r==null?void 0:r.users)!==void 0)for(const A in r.users)a.push({key:A,value:r.users[A]});return a},[r.users]);i.debug(b);const u=f.useMemo(()=>x.filter(a=>p.appRestApi.authorized_roles.includes(a.key)),[p.appRestApi.authorized_roles,x]),n=f.useMemo(()=>b.filter(a=>p.appRestApi.authorized_users.includes(a.key)),[p.appRestApi.authorized_users,b]);return e.jsxs(ee,{sx:{width:"100%"},children:[e.jsxs(Ls,{children:[e.jsxs(le,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(ge,{checked:p.appRestApi.authorization===G.AUTHORIZED,onChange:a=>{o(J({restApiActions:{...p.appRestApi,authorization:G.AUTHORIZED}})),s&&s(!0),a.stopPropagation()}}),"Authorized access only"]}),e.jsxs(l,{sx:{display:"grid",gridGap:"10px",margin:"30px 20px 25px 42px"},children:[e.jsx(ce,{multiple:!0,options:x,getOptionLabel:a=>a.value,value:u,onChange:(a,A)=>{o(J({restApiActions:{...p.appRestApi,authorized_roles:A.map(v=>v.key)}})),s&&s(!0),a.stopPropagation()},renderInput:a=>e.jsx(W,{...a,label:"Roles"})}),e.jsx(ce,{multiple:!0,options:b,getOptionLabel:a=>a.value,value:n,onChange:(a,A)=>{o(J({restApiActions:{...p.appRestApi,authorized_users:A.map(v=>v.key)}})),s&&s(!0),a.stopPropagation()},renderInput:a=>e.jsx(W,{...a,label:"Users"})})]}),e.jsxs(le,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(ge,{checked:p.appRestApi.authorization===G.ANONYMOUS,onChange:a=>{o(J({restApiActions:{...p.appRestApi,authorization:G.ANONYMOUS}})),s&&s(!0),a.stopPropagation()}}),"Anonymous access"]})]}),p.appRestApi.authorization===G.ANONYMOUS&&e.jsx(l,{sx:{marginTop:"10px",marginLeft:"10px"},children:e.jsx(se,{children:"This setting allows non-authorized users to access this app"})})]})},Zs=({app:s,setIsUpdated:o})=>{i.debug(s);const p=B();return e.jsxs(l,{sx:{display:"grid",gridGap:"30px"},children:[e.jsx(Re,{control:e.jsx(Ce,{checked:s.appAddToMenu,onChange:(r,x)=>{p(_e({appAddToMenu:x})),o&&o(!0),r.stopPropagation()}}),label:"Add App to WordPress dashboard menu",labelPlacement:"end"}),s.appAddToMenu&&e.jsx(W,{type:"text",label:"Title",fullWidth:!0,required:!0,helperText:"Title shown in WordPress dashboard menu",value:s.appMenuTitle,autoComplete:"off",onChange:r=>{p(Be({appMenuTitle:r.target.value})),o&&o(!0),r.stopPropagation()}})]})},$s=({app:s,setIsUpdated:o})=>{i.debug(s);const p=()=>`[wpda_app app_id="${s.appDbId}"${r?' feedback="true"':""}]`,[r,x]=f.useState(!1),[b,u]=f.useState(p());return f.useEffect(()=>{u(p())},[r]),e.jsxs(l,{sx:{display:"grid",gridGap:"20px"},children:[e.jsxs(l,{children:[e.jsx(le,{children:"App short code"}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center","& pre":{backgroundColor:"#ccc",padding:"4px"}},children:[e.jsx("pre",{children:b}),e.jsx(Os.CopyToClipboard,{text:b,onCopy:()=>{c("Shortcode was copied to your clipboard",{variant:"info"})},children:e.jsx(k,{title:"Copy shortcode to clipboard",children:e.jsx(_,{children:e.jsx(as,{})})})})]})]}),e.jsx(l,{children:e.jsxs(ee,{children:[e.jsx(Re,{control:e.jsx(Ce,{checked:r,onChange:(n,a)=>{x(a),o&&o(!0),n.stopPropagation()}}),label:"Feedback",labelPlacement:"end"}),e.jsx(se,{children:"Show authorization and usage errors"})]})})]})},Ks=({app:s,setIsUpdated:o})=>(i.debug(s),e.jsxs(l,{children:[e.jsxs(w,{disableGutters:!0,children:[e.jsx(E,{expandIcon:e.jsx(V,{}),children:"Authorize Roles & Users"}),e.jsx(Q,{children:e.jsx(we,{setIsUpdated:o})})]}),e.jsxs(w,{disableGutters:!0,children:[e.jsx(E,{expandIcon:e.jsx(V,{}),children:"Back-end Access"}),e.jsx(Q,{children:e.jsx(Zs,{app:s,setIsUpdated:o})})]}),e.jsxs(w,{disableGutters:!0,children:[e.jsx(E,{expandIcon:e.jsx(V,{}),children:"Front-end Access"}),e.jsx(Q,{children:e.jsx($s,{app:s,setIsUpdated:o})})]})]})),Vs=({appDbId:s})=>{var g,I;i.debug(s);const o=B(),p=((g=$)==null?void 0:g.palette.mode)===Fe.LIGHT?(I=$)==null?void 0:I.palette.primary.main:"",[r,x]=f.useState(!1);i.debug(r);const[b,u]=f.useState(!1);i.debug(b);const n=N(h=>de(h));i.debug("app",n);const a=()=>{o(je({}))},A=()=>{r?u(!0):a()},v=()=>n.appName?n.appTitle?n.appDatabase?n.appTable?n.appColumns.filter(h=>h.isSelected).length===0?(c("At least one column must be selected",{variant:"error"}),!1):!0:(c("Table is required",{variant:"error"}),!1):(c("Database is required",{variant:"error"}),!1):(c("App title is required",{variant:"error"}),!1):(c("App name is required",{variant:"error"}),!1),S=()=>{v()&&Rs(n,h=>{if(i.debug(h),h!=null&&h.code&&(h==null?void 0:h.message)!==void 0)switch(h.code){case"ok":c(h.message,{variant:"success"}),o(X({}));break;case"info":c(h.message,{variant:"info"});break;default:i.error(h),c(h.message??T.contactSupport,{variant:"error"})}else i.error(h),c(T.contactSupport,{variant:"error"})},h=>{i.error("error",h),c(h??T.contactSupport,{variant:"error"})})},M=()=>{v()&&(S(),a())},L=h=>{o(Pe({anchor:h}))},[F,t]=f.useState("1"),m=(h,C)=>{t(C)};return e.jsxs(e.Fragment,{children:[e.jsxs(js,{closeDrawer:A,children:[e.jsx(Ae,{position:"static",elevation:4,sx:{borderRadius:0},children:e.jsxs(Te,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsxs(l,{sx:{flexGrow:1},children:[e.jsx(be,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{display:{xs:"none",sm:"block"},paddingLeft:"6px"},children:"Manage App"}),e.jsx(be,{sx:{fontSize:"10px",display:{xs:"none",sm:"block"},paddingLeft:"10px"},children:n.appName})]}),e.jsx(ie,{title:"Dock to left",position:"bottom",children:e.jsx(_,{onClick:()=>{L(ue.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(As,{})})}),e.jsx(ie,{title:"Dock to right",position:"bottom",children:e.jsx(_,{onClick:()=>{L(ue.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Ts,{})})}),e.jsx(ie,{title:"Close",position:"bottom",children:e.jsx(_,{onClick:A,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(ye,{})})})]})}),e.jsx(ne,{className:"pp-settings-container",children:e.jsx(pe,{sx:{padding:0,margin:0},children:e.jsxs(ys,{value:F,children:[e.jsxs(Cs,{variant:"fullWidth",textColor:"primary",onChange:m,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(oe,{label:"App Info",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(oe,{label:"Data Source",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(oe,{label:"Access",value:"3",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(l,{sx:{margin:0,padding:0,overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(ae,{value:"1",children:e.jsx(Js,{app:n,setIsUpdated:x})}),e.jsx(ae,{value:"2",children:e.jsx(Hs,{app:n,setIsUpdated:x})}),e.jsx(ae,{value:"3",children:e.jsx(Ks,{app:n,setIsUpdated:x})})]})]})})}),e.jsx(ne,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:p},children:e.jsxs(pe,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(q,{variant:"outlined",className:"footer_action_button_apply",onClick:S,children:"Apply"}),e.jsx(q,{variant:"outlined",className:"footer_action_button",onClick:M,children:"OK"}),e.jsx(q,{variant:"outlined",className:"footer_action_button",onClick:A,children:"Cancel"})]})})]}),e.jsx(K,{title:"Close App Manager?",message:"All uncommitted changes will be lost!",open:b,setOpen:u,onConfirm:()=>{a()},onKeep:()=>{a()}})]})},Qs=({app:s})=>{var M,L,F;i.debug(s);const o=B(),[p,r]=f.useState(!1),[x,b]=f.useState(!1),u=t=>{ks(t,m=>{var I;const g=m==null?void 0:m.data;if(i.debug("response data",g),g.app&&g.app.app&&Array.isArray(g.app.app)&&g.app.container&&Array.isArray(g.app.container)){const h=g.app.app[0],C=g.app.container[0];i.debug(h,C);let R=[];try{R=JSON.parse(C.cnt_cls)}catch(H){i.error("Invalid JSON - app columns"),i.error(H),c("Invalid JSON, check console",{variant:"error"})}let D={};try{D=JSON.parse(h.app_settings)}catch(H){D.rest_api={authorization:G.AUTHORIZED,authorized_roles:[],authorized_users:[]},i.error("Invalid JSON - app settings"),i.error(H),c("Invalid JSON, check console",{variant:"error"})}o(qe({appDbId:t,appId:We(t),appName:h.app_name,appTitle:h.app_title,appType:h.app_type,appCntId:C.cnt_id,appCntSeqNr:C.cnt_seq_nr,appDatabase:C.cnt_dbs,appTable:C.cnt_tbl,appColumns:R,appRelationTable:null,appRelationColumns:[],appRestApi:D==null?void 0:D.rest_api,appAddToMenu:h.app_add_to_menu!=="0",appMenuTitle:((I=D==null?void 0:D.settings)==null?void 0:I.app_menu_title)??h.app_title,appMetaData:g}))}else c(T.contactSupport,{variant:"error"})},m=>{i.error("error",m),c(m??T.contactSupport,{variant:"error"})})},n=()=>{switch(s.appType){case y.DATAENTRY:return e.jsx(Y,{});case y.MASTERDETAIL:return e.jsx(Y,{});case y.REGISTRATION:return e.jsx(Y,{});case y.UPDATEFORM:return e.jsx(Y,{});default:return e.jsx(Y,{})}},a=()=>{Ms(s.appId,t=>{if(i.debug(t),t!=null&&t.code&&(t==null?void 0:t.message)!==void 0)switch(t.code){case"ok":c(t.message,{variant:"success"}),o(X({}));break;case"info":c(t.message,{variant:"info"});break;default:i.error(t),c(t.message??T.contactSupport,{variant:"error"})}else i.error(t),c(T.contactSupport,{variant:"error"});b(!1)},t=>{i.error("error",t),c(t??T.contactSupport,{variant:"error"}),b(!1)})},A=()=>{Is(s.appId,t=>{if(i.debug(t),t!=null&&t.code&&(t==null?void 0:t.message)!==void 0)switch(t.code){case"ok":c(t.message,{variant:"success"}),o(X({}));break;case"info":c(t.message,{variant:"info"});break;default:i.error(t),c(t.message??T.contactSupport,{variant:"error"})}else i.error(t),c(T.contactSupport,{variant:"error"});r(!1)},t=>{i.error("error",t),c(t??T.contactSupport,{variant:"error"}),r(!1)})},v=U("(max-width:700px)"),S=U("(max-width:900px)");return e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",padding:"24px",...S&&{".pp-row-actions":{width:0}},"&:hover":{".pp-row-title":{display:S?"inline-block":"none"},".pp-row-actions":{visibility:S?"hidden":"visible"}}},children:[e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",alignItems:"center"},children:[e.jsxs(l,{sx:{width:"100%",display:"grid",gridTemplateColumns:"auto 1fr",gridGap:"10px",justifyContent:"center",alignItems:"center"},children:[e.jsx(l,{children:n()}),e.jsxs(l,{sx:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},children:[s.appName,e.jsxs(l,{className:"pp-row-title",sx:{display:"inline-block",marginLeft:"5px",fontSize:"80%"},children:["−",e.jsx(l,{sx:{display:"inline-block",width:"5px"}}),s.appTitle]})]})]}),e.jsxs(l,{sx:{display:"grid",visibility:"hidden",gridTemplateColumns:"auto auto auto auto auto auto auto auto",gridGap:"10px",marginLeft:"10px",alignItems:"center"},className:"pp-row-actions",children:[e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(k,{title:"Manage App",children:e.jsx(Z,{sx:{cursor:"pointer"},underline:"none",onClick:t=>{u(s.appId),t.preventDefault(),t.stopPropagation()},children:"Manage"})}),e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(k,{title:"Run & Build App",children:e.jsx(Z,{sx:{cursor:"pointer"},underline:"none",onClick:t=>{o(xe({isActive:!0,appDbId:s.appId})),t.preventDefault(),t.stopPropagation()},children:"Run & Build"})}),e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(k,{title:"Copy App",children:e.jsx(Z,{sx:{cursor:"pointer"},underline:"none",onClick:t=>{b(!0),t.preventDefault(),t.stopPropagation()},children:"Copy"})}),e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(k,{title:"Delete App",children:e.jsx(Z,{sx:{cursor:"pointer"},underline:"none",onClick:t=>{r(!0),t.preventDefault(),t.stopPropagation()},children:"Delete"})})]})]}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto auto auto auto",justifyContent:v?"end":"space-evenly",alignItems:"center"},children:[e.jsx(l,{sx:{paddingRight:"10px"},children:v?"":Ge(s.appType)}),e.jsx(k,{title:"Manage App",children:e.jsx(_,{sx:{color:(M=$)==null?void 0:M.palette.primary.main},onClick:t=>{u(s.appId),t.preventDefault(),t.stopPropagation()},children:e.jsx(os,{})})}),e.jsx(k,{title:"Run & Build App",children:e.jsx(_,{sx:{color:(L=$)==null?void 0:L.palette.primary.main},onClick:t=>{o(xe({isActive:!0,appDbId:s.appId})),t.preventDefault(),t.stopPropagation()},children:e.jsx(ns,{})})}),e.jsx(k,{title:"Copy App",children:e.jsx(_,{onClick:t=>{b(!0),t.preventDefault(),t.stopPropagation()},children:e.jsx(ps,{})})}),e.jsx(k,{title:"Delete App",children:e.jsx(_,{sx:{color:(F=$)==null?void 0:F.palette.error.main},onClick:t=>{r(!0),t.preventDefault(),t.stopPropagation()},children:e.jsx(ls,{})})})]})]}),x&&e.jsx(K,{title:"Please confirm",message:"Copy this app including all containers?",open:x,setOpen:b,onConfirm:()=>a()}),p&&e.jsx(K,{title:"Delete App?",message:"Are you sure you want to delete this app? This action cannot be undone!",open:p,setOpen:r,onConfirm:()=>A()})]})},Xs=({apps:s,search:o,types:p,isLoading:r})=>{i.debug(s,o,p);const x=u=>!(!Ye(u.appName+" "+u.appTitle,o)||p.length>0&&p.filter(n=>n.id===Number(u.appType)).length===0),b=s.filter(u=>x(u)?u:null);return e.jsx(ke,{elevation:4,children:e.jsxs(l,{sx:{backgroundColor:"#fff",borderBottom:"1px solid rgba(0, 0, 0, 0.34)",borderRadius:"4px","& .MuiBox-root:first-of-type":{borderTopLeftRadius:"4px",borderTopRightRadius:"4px"},"& .MuiBox-root:hover":{backgroundColor:"rgb(242, 242, 242)"}},children:[...s.map(u=>{const n=x(u);return e.jsx(l,{className:"pp-app-details",sx:{borderTop:"1px solid rgba(0, 0, 0, 0.34)",visibility:n?"visible":"hidden",position:n?"relative":"fixed"},children:e.jsx(Qs,{app:u})})}),b.length===0&&e.jsx(l,{sx:{padding:"35px",borderTop:"1px solid rgba(0, 0, 0, 0.34)",borderRadius:"4px"},children:r?e.jsx(cs,{title:"Loading apps...",align:He.LEFT}):e.jsx(l,{children:"No apps found"})})]})})},Us=({setMode:s})=>{const o=B(),p=["App info","Data source","Authorization"],[r,x]=f.useState(0),[b,u]=f.useState(!1),n=N(m=>de(m));i.debug("app",n),f.useEffect(()=>{let m=null;switch(n.appType){case y.DATATABLE:m=G.ANONYMOUS;break;case y.DATAENTRY:case y.MASTERDETAIL:case y.REGISTRATION:case y.UPDATEFORM:case y.APPCONTAINER:m=G.AUTHORIZED;break}m!==null?o(J({restApiActions:Je(m)})):c(T.contactSupport,{variant:"error"})},[n.appType]);const[a,A]=f.useState({appName:!1,appTitle:!1,appDatabase:!1,appTable:!1,appColumns:!1});i.debug(a);const v=()=>{const m=_s(Ze);m.table.transactions.insert=Number(n.appType)===y.DATAENTRY||Number(n.appType)===y.MASTERDETAIL||Number(n.appType)===y.REGISTRATION,m.table.transactions.update=Number(n.appType)===y.DATAENTRY||Number(n.appType)===y.MASTERDETAIL||Number(n.appType)===y.UPDATEFORM,m.table.transactions.delete=Number(n.appType)===y.DATAENTRY||Number(n.appType)===y.MASTERDETAIL,Ns(n,m,g=>{if(i.debug(g),g!=null&&g.code&&(g==null?void 0:g.message)!==void 0)switch(g.code){case"ok":c(g.message,{variant:"success"}),s(z.TABLE),o(X({}));break;case"info":c(g.message,{variant:"info"});break;default:i.error(g),c(g.message??T.contactSupport,{variant:"error"})}else i.error(g),c(T.contactSupport,{variant:"error"})},g=>{i.error("error",g),c(g??T.contactSupport,{variant:"error"})})},S=()=>{var g,I;let m=!0;if(r===0){let h=!1,C=!1;n.appName.trim()===""&&(c("App name is required",{variant:"error"}),h=!0,m=!1),n.appTitle.trim()===""&&(c("App title is required",{variant:"error"}),C=!0,m=!1),A({...a,appName:h,appTitle:C})}if(r===1){let h=!1,C=!1,R=!1;((g=n.appDatabase)==null?void 0:g.trim())===""&&(c("Database is required",{variant:"error"}),h=!0,m=!1),((I=n.appTable)==null?void 0:I.trim())===""&&(c("Table is required",{variant:"error"}),C=!0,m=!1),n.appColumns.filter(D=>D.isSelected===!0).length===0&&(c("No columns selected",{variant:"error"}),R=!0,m=!1),A({...a,appDatabase:h,appTable:C,appColumns:R})}return r===2&&v(),i.debug(m),m},M=()=>e.jsxs(l,{sx:{textAlign:"right",display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[r>0?e.jsx(q,{variant:"outlined",size:"medium",sx:{width:"160px",marginRight:"10px"},onClick:()=>{x(r-1)},startIcon:e.jsx(ds,{}),children:e.jsx(l,{children:"Back"})}):e.jsx(l,{}),e.jsx(q,{variant:"contained",size:"medium",sx:{width:"160px"},onClick:()=>{S()&&r<2&&x(r+1)},startIcon:r>=2&&e.jsx(us,{}),endIcon:r<2&&e.jsx(xs,{}),children:e.jsx(l,{children:r<2?"Next":"Finish"})})]}),L=()=>e.jsxs(e.Fragment,{children:[e.jsx(Me,{app:n,hasErrors:a.appName}),e.jsx(Ie,{app:n,hasErrors:a.appName}),e.jsx(Ne,{app:n}),M()]}),F=()=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{}),e.jsx(l,{sx:{display:n.appDatabase?"block":"none"},children:e.jsx(Se,{})}),e.jsx(l,{sx:{display:n.appTable?"block":"none"},children:e.jsx(De,{app:n})}),M()]}),t=()=>e.jsxs(e.Fragment,{children:[e.jsx(l,{children:e.jsx(we,{})}),M()]});return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{sx:{padding:"50px 70px 40px 70px",display:"grid",gridGap:"40px"},elevation:4,children:[e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"start"},children:[e.jsx(zs,{title:"App Wizard",subheader:"Add new app",sx:{padding:0}}),e.jsx(l,{children:e.jsx(k,{title:"Close",children:e.jsx(Z,{sx:{cursor:"pointer"},underline:"none",onClick:m=>{u(!0),m.preventDefault(),m.stopPropagation()},children:e.jsx(l,{sx:{fontSize:"1.5rem",color:"#000"},children:e.jsx(ye,{})})})})})]}),e.jsxs(pe,{sx:{padding:0,display:"grid",gridGap:"30px"},children:[e.jsx(Bs,{activeStep:r,sx:{margin:"10px 0 30px 0"},children:p.map((m,g)=>(i.debug(m,g),e.jsx(Fs,{children:e.jsx(Ps,{children:m})},m)))}),e.jsxs("form",{onSubmit:m=>(m.preventDefault(),S()&&x(r+1),!1),style:{display:"grid",gridGap:"40px"},children:[r===0&&L(),r===1&&F(),r===2&&t(),e.jsx("input",{type:"submit",style:{display:"none"}})]})]})]}),e.jsx(K,{title:"Close App Wizard?",message:"All uncommitted changes will be lost!",open:b,setOpen:u,onConfirm:()=>{s(z.TABLE)}})]})};const kt=()=>{const s=B(),o=f.useMemo(()=>hs(),[]),[p,r]=f.useState(z.TABLE);i.debug(p),f.useEffect(()=>{const d=localStorage.getItem("ppAppsDbsSearch");d!==null&&s(he({dbSearch:d}));const j=localStorage.getItem("ppAppsDbsSearchType");if(j!==null){const O=JSON.parse(j);s(me({dbTypes:O}))}},[]);const x=N(d=>$e(d));i.debug("apps",x);const b=N(d=>Ke(d));i.debug("appDbId",b);const u=N(d=>Ve(d));i.debug("dbSearch",u);const n=N(d=>Qe(d));i.debug("dbTypes",n);const a=N(d=>Xe(d));i.debug("designMode",a);const A=N(d=>Ue(d));i.debug("reload",A);const[v,S]=f.useState(!0);f.useEffect(()=>{L(),M()},[A]);const M=()=>{ws(function(d){const j=d==null?void 0:d.data;if(i.debug("response data",j),Array.isArray(j)){const O=[];for(let P=0;P<j.length;P++)O.push({appId:j[P].app_id,appName:j[P].app_name,appTitle:j[P].app_title,appType:j[P].app_type,appSettings:j[P].app_settings,appAddToMenu:j[P].app_add_to_menu});s(te({appList:O}))}else i.error(j),c((j==null?void 0:j.message)??T.contactSupport,{variant:"error"}),s(te({appList:[]}));S(!1)},d=>{i.error("error",d),c(d??T.contactSupport,{variant:"error"}),s(te({appList:[]})),S(!1)})},L=()=>{Es(function(d){const j=d==null?void 0:d.data;i.debug("response data",j),s(ts({appMetaData:j}))},d=>{i.error("error",d),c(d??T.contactSupport,{variant:"error"})})};f.useEffect(()=>{es.appPlugin&&(p===1||a.isActive===!0&&a.appDbId>0?window.document.documentElement.style.setProperty("--addAppIconVisibility","hidden"):window.document.documentElement.style.setProperty("--addAppIconVisibility","visible"),window.ppActionCreateApp=function(){p===0&&!(a.isActive===!0&&a.appDbId>0)&&r(z.FORM)})},[p,a]);const[F,t]=f.useState(250),m=U("(max-width: 600px)"),g=U("(max-width: 900px)");f.useEffect(()=>{C.current&&t(C.current.offsetWidth)},[n]);const I=rs(),h=fe();i.debug(h);const C=f.useRef(),R=()=>a.isActive===!0&&a.appDbId>0,D=()=>e.jsx(k,{title:"Add new app",children:e.jsx(_,{sx:{color:"inherit"},onClick:()=>{s(je({})),r(z.FORM)},children:e.jsx(bs,{})})}),H={};return R()&&(H.visibility="hidden"),e.jsxs(ms,{theme:I,children:[e.jsxs(l,{className:"pp-applist",sx:{width:"100%",visibility:R()?"hidden":"visible",position:R()?"fixed":"auto",height:R()?0:"auto",...R()&&{"& *":{visibility:"hidden"}},"& .pp-app-details":{...H}},children:[e.jsx(Ae,{position:"relative",elevation:4,sx:{margin:"0 0 5px 0"},children:e.jsxs(Te,{className:"pp-applist-toolbar",sx:{display:"grid",gap:"12px",paddingRight:"12px !important",...m?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{gridTemplateColumns:"1fr",gridGap:"2px"}}:{...g?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{justifyContent:"space-between",gridTemplateColumns:"auto 1fr"}}:{justifyContent:"space-between",gridTemplateColumns:"1fr 1fr"}}},children:[e.jsxs(l,{className:"pp-applist-title",sx:{display:"inline-grid",gridTemplateColumns:"auto auto",justifyContent:"start",alignItems:"center",gridGap:"10px"},children:[e.jsx(l,{sx:{fontSize:"18px",lineHeight:"18px",fontWeight:"bold",whiteSpace:"nowrap"},children:"Apps"}),e.jsx(l,{children:D()})]}),e.jsxs(l,{className:"pp-applist-search",sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",justifyContent:"end",alignItems:"center"},children:[e.jsx(W,{value:u,type:"search",placeholder:"Search",disabled:p===z.FORM,onChange:d=>{s(he({dbSearch:d.target.value})),localStorage.setItem("ppAppsDbsSearch",d.target.value)},sx:{backgroundColor:"#fff",fontSize:"1em",margin:0,padding:0,borderRadius:"4px","&.MuiFormControl-root.MuiTextField-root .MuiInputBase-root":{paddingRight:0},"&.MuiFormControl-root.MuiTextField-root input":{padding:"8px"}},InputProps:{startAdornment:e.jsx(qs,{position:"end",sx:{fontSize:"1.5rem",padding:0,margin:0},children:e.jsx(gs,{})})}}),e.jsx(ce,{multiple:!0,size:"small",options:h,getOptionLabel:d=>d.text,isOptionEqualToValue:(d,j)=>d.id===j.id,value:n,disableCloseOnSelect:!0,disabled:p===z.FORM,onChange:(d,j)=>{s(me({dbTypes:j.map(O=>({id:O.id,text:Object.values(ss)[O.id]}))})),localStorage.setItem("ppAppsDbsSearchType",JSON.stringify(j))},PaperComponent:({children:d})=>e.jsx(ke,{sx:{width:`${F}px`},children:d}),renderOption:(d,j,{selected:O})=>e.jsxs("li",{...d,children:[e.jsx(Ws,{style:{marginRight:8},checked:O}),j.text]}),renderInput:d=>e.jsx(l,{ref:C,children:e.jsx(W,{...d,sx:{minWidth:"250px","& .MuiInputBase-root":{backgroundColor:"#fff",padding:"0",maxHeight:"39px",overflow:"hidden"},"& .MuiButtonBase-root.MuiChip-root.MuiAutocomplete-tag":{height:"auto"}},placeholder:n.length===0?"Select app types":""})})})]})]})}),p===z.TABLE&&e.jsx(Xs,{apps:x,search:u,types:n,isLoading:v}),p===z.FORM&&e.jsx(Us,{setMode:r}),b!==0&&b!==void 0&&e.jsx(Vs,{appDbId:b})]}),a.isActive===!0&&a.appDbId>0&&e.jsx(Gs,{appId:o,appDbId:a.appDbId,designMode:!0})]})};export{kt as default};
