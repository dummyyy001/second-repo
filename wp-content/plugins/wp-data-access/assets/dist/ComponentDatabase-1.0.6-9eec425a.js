import{l,r as h,A as N,j as s,cY as W,cZ as L,e as g,C as D,c_ as B,c$ as P,d0 as w,d1 as O,d2 as q,d3 as z,d4 as H,d5 as k,d6 as M,d7 as I,d8 as V,d9 as Y,da as Z,db as $,dc as G,dd as J,de as K,df as v}from"./main-1.0.6.js";import{u as A,B as T,a as Q,T as X,af as U,b as x}from"./main-1.0.6-7aa8b30c.js";import{A as aa}from"./AdminTheme-1.0.6-6896de59.js";import{k as ea}from"./ActionsApp-1.0.6-68143703.js";import{F as y,b as ta,a as C,A as R,T as _}from"./TextField-1.0.6-b41aa978.js";import{P as sa,I as la}from"./iconBase-1.0.6-b8af29f5.js";import{F as ra}from"./FormControlLabel-1.0.6-72a72881.js";import{C as na}from"./Checkbox-1.0.6-26443287.js";import{d as E,e as F,h as oa}from"./ActionsExplorer-1.0.6-044b946f.js";const xa=({app:e,setIsUpdated:p,isRelationTable:o})=>{l.debug(e,o);const u=A(),[m,c]=h.useState(!1),f=h.useRef(!0);h.useEffect(()=>{f.current?f.current=!1:a()},[e.appDatabase,e.appTable,e.appRelationTable,u]);const a=()=>{e.appDatabase!==null&&(!o&&e.appTable!==null||o&&e.appRelationTable!==null)&&(c(!0),ea(e.appDatabase,o?e.appRelationTable??"":e.appTable??"",!1,function(n){const d=n==null?void 0:n.data;if(l.debug("response data",e.appDatabase,o?e.appRelationTable:e.appTable,d),!d.columns)g(D.contactSupport,{variant:"error"});else{const b=[];d.columns.map(j=>{j.column_name!==void 0&&b.push({columnName:j.column_name,isSelected:!0})}),u(o?B({appRelationColumns:b}):P({appColumns:b,appMetaData:d}))}c(!1)},n=>{l.error("error",n),g(n??D.contactSupport,{variant:"error"}),c(!1)}))},[r,t]=h.useState(!1);l.debug("hasErrors",r);const i=o?e.appRelationColumns:e.appColumns;return l.debug("columns",i),h.useEffect(()=>{Number(e.appType)!==N.DATATABLE&&e.appMetaData.primary_key!==void 0?t(e.appMetaData.primary_key.length===0||e.appMetaData.primary_key.filter(n=>i.filter(b=>b.isSelected).map(b=>b.isSelected?b.columnName:!1).includes(n)).length!==e.appMetaData.primary_key.length):t(!1)},[e,i]),s.jsxs(T,{sx:{position:"relative"},children:[s.jsxs(y,{fullWidth:!0,children:[s.jsxs(T,{component:"fieldset",sx:{borderWidth:1,borderRadius:"4px","& .MuiPaper-root":{border:"none",padding:"15px 20px"},"& .MuiFormHelperText-root":{marginLeft:"20px",marginBottom:"20px"}},children:[s.jsx("legend",{style:{fontSize:"0.75rem",fontWeight:400,color:"rgba(0, 0, 0, 0.6)"},children:"Select columns *"}),s.jsxs(sa,{variant:"outlined",sx:{padding:"15px 30px"},children:[i.length===0&&s.jsx(y,{fullWidth:!0,sx:{margin:"5px 0"},children:s.jsx(ta,{sx:{color:"inherit"},children:"No table selected"})}),...i.map((n,d)=>{var b;return s.jsx(ra,{control:s.jsx(na,{checked:n.isSelected,onChange:(j,S)=>{u(o?W({appRelationColumns:[...e.appRelationColumns.slice(0,d),{columnName:n.columnName,isSelected:S},...e.appRelationColumns.slice(d+1)]}):L({appColumns:[...e.appColumns.slice(0,d),{columnName:n.columnName,isSelected:S},...e.appColumns.slice(d+1)]})),p&&p(!0)}}),label:s.jsx(T,{sx:{color:r&&e.appMetaData.primary_key.includes(n.columnName)?(b=aa)==null?void 0:b.palette.error.main:""},children:n.columnName+(r&&e.appMetaData.primary_key.includes(n.columnName)?" (primary key column)":"")}),sx:{width:"100%"}})})]})]}),s.jsx(C,{children:"Only selected columns are available in tables and forms. Unselected columns are excluded from responses. At least one column must be selected."}),!m&&e.appDatabase!==null&&(!o&&e.appTable!==null||!o&&e.appRelationTable!==null)&&r&&s.jsxs(C,{error:!0,sx:{marginTop:"20px",width:"fit-content",display:"inline-grid",gridTemplateColumns:"40px auto",justifyContent:"space-around",alignItems:"center"},children:[s.jsx(Q,{size:"24px"}),s.jsx("span",{children:e.appMetaData.primary_key.length===0?s.jsx(s.Fragment,{children:"This table contains no primary key. Transactions are not supported for tables without a primary key. Please create a primary key to continue or select app type Data Table in the app info tab."}):s.jsxs(s.Fragment,{children:["Transactions require all primary key columns to be selected. With the current settings transactions will be disabled for table ",o?e.appRelationTable:e.appTable,"."]})})]})]}),s.jsx(T,{sx:{position:"absolute",top:"15px",right:"10px"},children:s.jsx(X,{title:"Refresh column list",children:s.jsx(la,{onClick:()=>{a()},children:s.jsx(U,{})})})})]})},ga=({setIsUpdated:e,isDetail:p,isRelationTable:o})=>{const u=A(),m=x(t=>w(t));l.debug("appDatabase",m);const c=x(t=>O(t));l.debug("tables",c);const f=x(t=>q(t));l.debug("views",f);const a=x(t=>z(t));l.debug("appTable",a);const r=x(t=>H(t));return l.debug("appRelationTable",r),h.useEffect(()=>{m!==null&&(c.length===0||f.length===0)&&(E(m,function(t){const i=t==null?void 0:t.data;l.debug("response data",i),u(k({tables:i}))},t=>{l.error("error",t),g(t??D.contactSupport,{variant:"error"})}),F(m,function(t){const i=t==null?void 0:t.data;l.debug("response data",i),u(M({views:i}))},t=>{l.error("error",t),g(t??D.contactSupport,{variant:"error"})}))},[m]),s.jsxs(y,{sx:{width:"100%",marginTop:"8px"},children:[s.jsx(R,{options:m!==null?c.concat(f).sort():[],value:o?r:a,onChange:(t,i)=>{u(o?I({appRelationTable:i??null}):V({appTable:i??null})),e&&e(!0)},renderInput:t=>s.jsx(_,{...t,label:"Table *",variant:"outlined"}),sx:{width:"100%"}}),s.jsxs(C,{children:["Select a table from the list",p===void 0&&s.jsx(s.Fragment,{children:"Â (additional tables can be added in the Form Builder)"})]})]})},Da=({setIsUpdated:e})=>{const p=A(),o=x(a=>Y(a));l.debug("databases",o);const u=x(a=>Z(a));l.debug("wpDatabase",u);const m=x(a=>$(a));l.debug("defaultDatabase",m);const c=x(a=>w(a));l.debug("appDatabase",c),h.useEffect(()=>{o.length===0?oa(function(a){const r=a==null?void 0:a.data;l.debug("response data",r);const t=[];let i="",n="";r.map(d=>{t.push(d.dbs),d.dbs_type.toLocaleLowerCase()==="wp"&&(i=d.dbs,n=d.dbs)}),t.sort((d,b)=>d.localeCompare(b,void 0,{sensitivity:"base"})),p(G({databases:t})),p(J({wpDatabase:i})),p(K({defaultDatabase:n})),c===null&&p(v({appDatabase:n})),l.debug(t,i,n)},a=>{l.error("error",a),g(a??D.contactSupport,{variant:"error"})}):c===null&&p(v({appDatabase:m}))},[]);const f=h.useRef(!0);return h.useEffect(()=>{f.current?f.current=!1:c!==null&&o.includes(c)&&(E(c,function(a){const r=a==null?void 0:a.data;l.debug("response data",r),p(k({tables:r}))},a=>{l.error("error",a),g(a??D.contactSupport,{variant:"error"})}),F(c,function(a){const r=a==null?void 0:a.data;l.debug("response data",r),p(M({views:r}))},a=>{l.error("error",a),g(a??D.contactSupport,{variant:"error"})}))},[c]),s.jsxs(y,{sx:{width:"100%",marginTop:"8px"},children:[s.jsx(R,{options:o,value:c,onChange:(a,r)=>{p(v({appDatabase:r??null})),e&&e(!0)},getOptionLabel:a=>u===a?a+" (WordPress database)":a,renderInput:a=>s.jsx(_,{...a,label:"Database *",variant:"outlined"}),renderOption:(a,r)=>s.jsxs(T,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...a,children:[r," ",u===r?" (WordPress database)":""]}),sx:{width:"100%"}}),s.jsx(C,{children:"Select a database from the list"})]})};export{Da as C,ga as a,xa as b};
