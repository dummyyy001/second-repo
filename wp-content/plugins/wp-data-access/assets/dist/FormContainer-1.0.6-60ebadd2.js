import{r as m,_ as y,bZ as yt,l as o,b_ as Mt,b$ as p,c0 as lt,j as r,P as wt,b4 as Dt,ay as w,c1 as Tt,c2 as Rt,c3 as Ft,c4 as K,c5 as I,c6 as Pt,c7 as At,C as x,e as g,c8 as Vt,c9 as k,ca as tt,cb as Lt,cc as Ot,bT as et,cd as kt,b7 as pt}from"./main-1.0.6.js";import{b as E,a1 as st,B as Y,a2 as Yt,S as B,u as Bt,V as Nt,v as Ut,f as at,H as zt,a3 as nt,a4 as Ht,n as Gt}from"./main-1.0.6-7aa8b30c.js";import{C as $t,a as Jt,B as R,b as qt}from"./AdminTheme-1.0.6-6896de59.js";import{s as Qt,u as Wt,i as ot}from"./ActionsDml-1.0.6-4c91d556.js";import{d as A}from"./dayjs.min-1.0.6-fcad92ca.js";import{C as Zt}from"./CardActions-1.0.6-6d819e5d.js";m.lazy(()=>y(()=>import("./TableContainer-1.0.6-209eb742.js").then(e=>e.T),["./TableContainer-1.0.6-209eb742.js","./main-1.0.6.js","./AdminTheme-1.0.6-6896de59.js","./iconBase-1.0.6-b8af29f5.js","./index.esm-1.0.6-8607d2e4.js","./Close-1.0.6-4b5eac8d.js","./TextField-1.0.6-b41aa978.js","./main-1.0.6-7aa8b30c.js","./main-1.0.6-ca6efa15.css","./FormControlLabel-1.0.6-72a72881.js","./MenuItem-1.0.6-b9a91535.js","./settings-1.0.6-c1644694.js","./DialogContent-1.0.6-e7b9fcb3.js","./Tabs-1.0.6-e49ea330.js","./settings-1.0.6-5a196fc8.css","./Radio-1.0.6-2befae95.js","./Checkbox-1.0.6-26443287.js","./AlertTitle-1.0.6-986ff958.js","./useSlot-1.0.6-8db722c4.js","./InputAdornment-1.0.6-f8c6f282.js","./DateTimePicker-1.0.6-71307f11.js","./useMobilePicker-1.0.6-328fb89a.js","./date-time-utils-1.0.6-04701755.js","./dateViewRenderers-1.0.6-faae157e.js","./TimePicker-1.0.6-dfb27941.js","./DatePicker-1.0.6-75aa4c76.js","./ScopeEnum-1.0.6-035f2615.js","./ActionsDml-1.0.6-4c91d556.js","./useStoreTable-1.0.6-edd54d94.js","./index.esm-1.0.6-d540f227.js","./index-1.0.6-601a5223.js","./vi-1.0.6-f3183323.js","./dayjs.min-1.0.6-fcad92ca.js","./TableContainer-1.0.6-04aa7508.css"],import.meta.url));m.lazy(()=>y(()=>Promise.resolve().then(()=>N),void 0,import.meta.url));m.lazy(()=>y(()=>import("./TableContainer-1.0.6-209eb742.js").then(e=>e.T),["./TableContainer-1.0.6-209eb742.js","./main-1.0.6.js","./AdminTheme-1.0.6-6896de59.js","./iconBase-1.0.6-b8af29f5.js","./index.esm-1.0.6-8607d2e4.js","./Close-1.0.6-4b5eac8d.js","./TextField-1.0.6-b41aa978.js","./main-1.0.6-7aa8b30c.js","./main-1.0.6-ca6efa15.css","./FormControlLabel-1.0.6-72a72881.js","./MenuItem-1.0.6-b9a91535.js","./settings-1.0.6-c1644694.js","./DialogContent-1.0.6-e7b9fcb3.js","./Tabs-1.0.6-e49ea330.js","./settings-1.0.6-5a196fc8.css","./Radio-1.0.6-2befae95.js","./Checkbox-1.0.6-26443287.js","./AlertTitle-1.0.6-986ff958.js","./useSlot-1.0.6-8db722c4.js","./InputAdornment-1.0.6-f8c6f282.js","./DateTimePicker-1.0.6-71307f11.js","./useMobilePicker-1.0.6-328fb89a.js","./date-time-utils-1.0.6-04701755.js","./dateViewRenderers-1.0.6-faae157e.js","./TimePicker-1.0.6-dfb27941.js","./DatePicker-1.0.6-75aa4c76.js","./ScopeEnum-1.0.6-035f2615.js","./ActionsDml-1.0.6-4c91d556.js","./useStoreTable-1.0.6-edd54d94.js","./index.esm-1.0.6-d540f227.js","./index-1.0.6-601a5223.js","./vi-1.0.6-f3183323.js","./dayjs.min-1.0.6-fcad92ca.js","./TableContainer-1.0.6-04aa7508.css"],import.meta.url));m.lazy(()=>y(()=>Promise.resolve().then(()=>N),void 0,import.meta.url));m.lazy(()=>y(()=>Promise.resolve().then(()=>N),void 0,import.meta.url));const Xt=e=>{const u=E(d=>yt(d,e));return o.debug("storeColumns",u),u},Kt=e=>{const u=E(d=>Mt(d,e));return o.debug("moreState",u),u},It=m.lazy(()=>y(()=>import("./Row-1.0.6-e4f6f86e.js"),["./Row-1.0.6-e4f6f86e.js","./main-1.0.6.js","./main-1.0.6-7aa8b30c.js","./iconBase-1.0.6-b8af29f5.js","./main-1.0.6-ca6efa15.css","./AdminTheme-1.0.6-6896de59.js","./ActionsDml-1.0.6-4c91d556.js","./dayjs.min-1.0.6-fcad92ca.js","./CardActions-1.0.6-6d819e5d.js"],import.meta.url)),te=({appId:e,metaData:u,primaryKey:d,formMode:v,formUuid:D})=>{var j;o.debug(e,u,d,v,D);const S=st(e),M=E(b=>p(b,e));o.debug("data",M);const f=E(b=>lt(b,e));o.debug("initialData",f);let C="30px";return r.jsx("form",{id:D,className:"pp-form-content",onSubmit:b=>(b.preventDefault(),!1),children:r.jsx(Y,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${S.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(S.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:C,marginBottom:0,background:S.showGrid?((j=Yt)==null?void 0:j.palette.mode)===wt.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":""},children:r.jsx(m.Suspense,{fallback:r.jsx(B,{}),children:r.jsx(It,{appId:e,metaData:u,data:M,initialData:f,primaryKey:d,formMode:v,formSettings:S})})})})};const ee=m.lazy(()=>y(()=>import("./Alert-1.0.6-728945e9.js"),["./Alert-1.0.6-728945e9.js","./main-1.0.6.js","./index.esm-1.0.6-f58f385b.js","./iconBase-1.0.6-b8af29f5.js","./AlertTitle-1.0.6-986ff958.js","./Close-1.0.6-4b5eac8d.js","./useSlot-1.0.6-8db722c4.js"],import.meta.url)),ae=({appId:e,primaryKey:u,formMode:d,showTable:v,showForm:D,detailKey:S,children:M,relationAppId:f,relTab:C,joinTab:j,isEmbedded:b})=>{var Z;o.debug(e,u,d,S,f,C,j,b);const h=Bt(),V=Xt(e),it=Nt(),U=m.useMemo(()=>Ut(),[]),[ut,L]=m.useState(!1),[ct,z]=m.useState(!1),[H,mt]=m.useState(""),a=m.useMemo(()=>Dt(w.getState(),e),[e]);o.debug("metaData",a);const T=Tt((Z=a==null?void 0:a.app)==null?void 0:Z.container[0]),F=E(n=>p(n,e));o.debug("data",F);const dt=E(n=>lt(n,e));o.debug("initialData",dt);const O=E(n=>Rt(n,e));o.debug("m2mUpdate",O),m.useEffect(()=>{O===!0&&P(!1,()=>{h(I({appId:e,update:!1}))})},[O]),m.useEffect(()=>{u===null?gt():Object.keys(u).length>0?ft():L(!0)},[u]);const ft=()=>{Qt(e,u,a==null?void 0:a.media,n=>{if(o.debug(n),n!==null){const s={...n.context};delete s.debug;const i={...n.data[0]};h(K({appId:e,data:i,context:s})),L(n!==null)}else g(x.contactSupport,{variant:"error"})},n=>{o.error("error",n),mt(n??x.contactSupport)},!1,C)},gt=()=>{var n,s;if(a.columns&&Array.isArray(a.columns)){const i={},l=Ft(w.getState(),e);o.debug("defaultValues",l);for(let t=0;t<a.columns.length;t++)i[a.columns[t].column_name]=null,l[a.columns[t].column_name]!==void 0&&(l[a.columns[t].column_name]==="@wpda_wp_user_id"?i[a.columns[t].column_name]=(s=(n=a==null?void 0:a.settings)==null?void 0:n.env)==null?void 0:s.id:l[a.columns[t].column_name]==="@now"?a.columns[t]==="date"?i[a.columns[t].column_name]=A(Date.now()).format("YYYY-MM-DD"):i[a.columns[t].column_name]=A(Date.now()).format("YYYY-MM-DD HH:mm:ss"):a.columns[t].column_default!==null&&a.columns[t].column_default!==""?a.columns[t].column_default==="CURRENT_TIMESTAMP"?a.columns[t]==="date"?i[a.columns[t].column_name]=A(Date.now()).format("YYYY-MM-DD"):i[a.columns[t].column_name]=A(Date.now()).format("YYYY-MM-DD HH:mm:ss"):i[a.columns[t].column_name]=a.columns[t].column_default:i[a.columns[t].column_name]=l[a.columns[t].column_name]);o.debug(i),h(K({appId:e,data:i,context:{media:{}}})),o.debug("init"),L(!0)}},G=()=>{let n="";for(const s in a.columns)a.columns[s].extra==="auto_increment"&&(n=a.columns[s].column_name);return o.debug(n),n},_t=n=>{for(let s=0;s<a.columns.length;s++)if(a.columns[s].column_name===n)return a.columns[s]},$=n=>{const s=Vt(w.getState(),e);o.debug("rowValidation",s);let i=!1;for(const c in s)if(s[c].error===!0&&s[c].type===k.COLUMN){i=!0;break}if(i)return o.debug("validateForm returned errors"),!1;let l=!0;const t=G();for(const c in n){const _=_t(c);let X=!0;_.column_name!==t&&_.is_nullable==="NO"&&(n[c]===""&&(d===nt.INSERT||ht.preserveSpacesOnUpdate===!1)||n[c]===null||n[c]===void 0)&&(h(tt({appId:e,columnName:c,columnError:!0,columnText:"Field must be entered",columnType:k.FORM})),X=!1,l=!1);const Et=Lt(w.getState(),e,c);o.debug(Et),X&&h(tt({appId:e,columnName:c,columnError:!1,columnText:"",columnType:k.FORM}))}return l},P=(n,s)=>{const i=p(w.getState(),e);if(o.debug(i),$(i)){if(u!==null){const l={};Object.keys(i).map(t=>{V.map(c=>{t===c.columnName&&c.updatable&&(l[t]=i[t])})}),o.debug(l),Wt(e,u,l,t=>{var c;if(o.debug(t),t!=null&&t.code&&(t!=null&&t.message))switch(t.code){case"ok":z(!0),g(t.message,{variant:"success"}),((c=t.context)==null?void 0:c.updated)!==void 0&&Object.keys(t.context.updated).map(_=>{h(Ot({appId:e,columnName:_,columnValue:t.context.updated[_]}))}),n&&(s!==void 0&&s(u),setTimeout(()=>{v(!0,f)},1e3));break;case"info":g(t.message,{variant:"info"}),n&&(s!==void 0&&s(u),setTimeout(()=>{v(!0,f)},1e3));break;default:o.error(t),g(t.message??x.contactSupport,{variant:"error"}),n&&v(!0,f)}else o.error(t),g(x.contactSupport,{variant:"error"})},t=>{o.error("error",t),g(t??x.contactSupport,{variant:"error"})},!1,j,C)}else ot(e,i,l=>{if(o.debug(l),l!=null&&l.code&&(l!=null&&l.message)){let t;const c={};switch(l.code){case"ok":z(!0),g(l.message,{variant:"success"}),t=G();for(let _=0;_<a.primary_key.length;_++)t!==""?c[a.primary_key[_]]=l.context.insert_id:c[a.primary_key[_]]=i[a.primary_key[_]];if(o.debug(c),n){s!==void 0&&s(c),v(!0,f);return}D(c,Ht.UPDATE);break;default:o.error(l),g(l.message??x.contactSupport,{variant:"error"})}}else o.error(l),g(x.contactSupport,{variant:"error"})},l=>{o.error("error",l),g(l??x.contactSupport,{variant:"error"})},!1,j,C);s!==void 0?s():f!==void 0&&h(I({appId:f,update:!0}))}},xt=n=>{if(n!==null&&$(F)){const s=et(w.getState(),e),i=s.state.relation.relation_join_condition.split(",").map(t=>t.split("=")),l={...s.state.detailKey};i.map(t=>{l[t[0]]=F[t[1]]}),ot(e,l,t=>{if(o.debug(t),t!=null&&t.code&&(t!=null&&t.message))switch(t.code){case"ok":o.debug("Added relation to join table",t);break;default:o.error(t),g(t.message??x.contactSupport,{variant:"error"})}else o.error(t),g(x.contactSupport,{variant:"error"})},t=>{o.error(t),g(t??x.contactSupport,{variant:"error"})},!1,!0,!1)}},vt=()=>{P(!1)},bt=()=>{const n=et(w.getState(),e);o.debug(n.state.relation),n.state.relation!==void 0&&n.state.relation.cardinality===kt.MANY_TO_MANY?P(!0,xt):P(!0)},J=()=>{v(ct,f)},ht=st(e),q=E(n=>Pt(n,e));o.debug("moreEnabled",q);const Q=Kt(e);at("(max-width: 600px)"),at("(max-width: 900px)");const St={paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"};let jt="30px",Ct="0";if(H!=="")return r.jsx(m.Suspense,{children:r.jsx(ee,{severity:"error",message:H,close:!1})});const W=()=>r.jsx(te,{appId:e,metaData:a,primaryKey:u,formMode:d,formUuid:U});return b?W():r.jsx("div",{className:`${e}_wrapper pp-form`,children:ut&&F!==null?r.jsxs($t,{sx:St,elevation:it,children:[r.jsxs(Jt,{sx:{padding:0,margin:"5px 0 0 0"},children:[W(),M]}),r.jsxs(Zt,{sx:{marginTop:jt,padding:0,paddingRight:Ct,justifyContent:"space-between",alignItems:"center"},children:[r.jsxs(Y,{sx:{display:"flex",gap:"8px"},children:[!1,q&&r.jsx(R,{variant:"outlined",startIcon:r.jsx(zt,{}),onClick:()=>{h(At({appId:e,more:!Q}))},children:Q?"Less":"More"})]}),r.jsx(Y,{children:d!==nt.VIEW?r.jsxs(r.Fragment,{children:[r.jsx(R,{variant:"contained",onClick:vt,type:"submit",form:U,children:"APPLY"}),(T==null?void 0:T.cardinality)!==0&&r.jsxs(r.Fragment,{children:[r.jsx(R,{variant:"outlined",onClick:bt,sx:{marginLeft:"8px"},children:"OK"}),r.jsx(R,{variant:"outlined",onClick:J,sx:{marginLeft:"8px"},children:"CANCEL"})]})]}):r.jsx(r.Fragment,{children:(T==null?void 0:T.cardinality)!==0&&r.jsx(R,{variant:"contained",onClick:J,children:"BACK"})})})]}),r.jsx(r.Fragment,{children:!1})]}):r.jsx("div",{style:{padding:"50px"},children:r.jsx(B,{title:"Loading data..."})})})},ne=m.lazy(()=>y(()=>import("./Settings-1.0.6-ea4f3641.js"),["./Settings-1.0.6-ea4f3641.js","./main-1.0.6.js","./main-1.0.6-7aa8b30c.js","./iconBase-1.0.6-b8af29f5.js","./main-1.0.6-ca6efa15.css","./AdminTheme-1.0.6-6896de59.js","./useMetadataColumns-1.0.6-e1d155d7.js","./useStoreTable-1.0.6-edd54d94.js","./index.esm-1.0.6-e9e7a4c1.js","./ActionsDml-1.0.6-4c91d556.js","./index.esm-1.0.6-d540f227.js","./TextField-1.0.6-b41aa978.js","./Close-1.0.6-4b5eac8d.js","./MenuItem-1.0.6-b9a91535.js","./index-1.0.6-f35018af.js","./useTableUpdater-1.0.6-7a34b388.js","./Stepper-1.0.6-9f47df68.js","./settings-1.0.6-c1644694.js","./FormControlLabel-1.0.6-72a72881.js","./DialogContent-1.0.6-e7b9fcb3.js","./Tabs-1.0.6-e49ea330.js","./settings-1.0.6-5a196fc8.css","./Checkbox-1.0.6-26443287.js","./AccordionSummary-1.0.6-e78821a8.js","./useSlot-1.0.6-8db722c4.js","./PremiumFeature-1.0.6-12f86a87.js","./EnumTypeEnum-1.0.6-7ffcf33a.js","./ScopeEnum-1.0.6-035f2615.js","./RadioGroup-1.0.6-adb96ecd.js","./Radio-1.0.6-2befae95.js","./Link-1.0.6-610563e0.js","./CssUnitTextField-1.0.6-f103b81e.js","./ComponentDatabase-1.0.6-9eec425a.js","./ActionsApp-1.0.6-68143703.js","./ActionsExplorer-1.0.6-044b946f.js","./DefaultWhere-1.0.6-5077189f.js","./ThemeSettings-1.0.6-6c1a1567.js","./index-1.0.6-601a5223.js"],import.meta.url)),rt=({appId:e,primaryKey:u,formMode:d,showTable:v,showForm:D,metaData:S,detailKey:M,selectionForm:f})=>{o.debug(e,u,d,S,M,f);const C=qt(),j=m.useMemo(()=>{},[]);o.debug("relationAppId",j);const b=()=>null,h=()=>null,V=()=>null;return r.jsxs(r.Fragment,{children:[f===!0?r.jsx(r.Fragment,{children:b()}):r.jsx(ae,{appId:e,primaryKey:u,formMode:d,showTable:v,showForm:D,detailKey:M,relationAppId:j,children:h()}),pt(S)&&r.jsx(Gt,{theme:C,children:r.jsx(m.Suspense,{fallback:r.jsx(B,{title:"Loading form settings..."}),children:r.jsx(ne,{appId:e})})}),V()]})},N=Object.freeze(Object.defineProperty({__proto__:null,FormContainer:rt,default:rt},Symbol.toStringTag,{value:"Module"}));export{N as F,Kt as a,Xt as u};
